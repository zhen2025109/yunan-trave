<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <!-- è§†å£è®¾ç½®ï¼šç¦æ­¢ç¼©æ”¾ï¼Œé€‚é…åˆ˜æµ·å±ï¼Œé”å®šå®½é«˜ç­‰æ¯” -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>å°å°é‡Œç¨‹å¸ˆï¼šäº‘å—è·¯çº¿å¤§æŒ‘æˆ˜</title>
    <meta name="description" content="ä¸€ä¸ªé€‚é…ä¸‰å¹´çº§å­¦ç”Ÿçš„æ•°å­¦é‡Œç¨‹é—®é¢˜äº’åŠ¨å°æ¸¸æˆ">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=ZCOOL+KuaiLe&display=swap');

        :root {
            --sky-top: #0ea5e9;
            --sky-bottom: #bae6fd;
            --grass-top: #4ade80;
            --grass-bottom: #16a34a;
        }

        /* å…¨å±€å¸ƒå±€ä¸èƒŒæ™¯è®¾ç½® */
        html, body {
            margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden;
            font-family: 'ZCOOL KuaiLe', cursive, sans-serif;
            background: linear-gradient(180deg, 
                var(--sky-top) 0%, 
                var(--sky-bottom) 45%, 
                #ffffff 45%, 
                #ffffff 50%, 
                var(--grass-top) 50%, 
                var(--grass-bottom) 100%
            );
            background-attachment: fixed;
            touch-action: none; /* ç¦æ­¢ç³»ç»Ÿçº§æ‰‹åŠ¿ */
            -webkit-user-select: none;
            user-select: none;
        }

        /* --- åŠ¨ç”»èƒŒæ™¯å…ƒç´  --- */
        .cloud {
            position: absolute; background: white; border-radius: 100px; opacity: 0.8;
            filter: blur(2px); z-index: 1; animation: cloud-move infinite linear;
        }
        .cloud::after, .cloud::before { content: ''; position: absolute; background: white; border-radius: 50%; }
        .cloud::after { width: 60%; height: 150%; top: -60%; left: 15%; }
        .cloud::before { width: 50%; height: 120%; top: -40%; left: 40%; }
        @keyframes cloud-move {
            from { transform: translateX(-250px); }
            to { transform: translateX(calc(100vw + 250px)); }
        }

        /* --- å¤´éƒ¨æ ·å¼ --- */
        .header-bg {
            background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(8px);
            padding: 15px; padding-top: calc(15px + env(safe-area-inset-top));
            border-bottom: 4px solid rgba(255,255,255,0.5); position: relative; z-index: 100;
        }

        /* --- åœ°å›¾æ ¸å¿ƒåŒºåŸŸ --- */
        .route-map {
            position: relative; width: 94%; height: 220px; margin: 20px auto;
            background: rgba(255, 255, 255, 0.3); backdrop-filter: blur(10px);
            border-radius: 35px; border: 6px solid white; display: flex;
            align-items: center; padding: 0 50px; z-index: 10;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .road-line { position: absolute; height: 16px; background: rgba(0, 0, 0, 0.1); border-radius: 20px; width: calc(100% - 100px); left: 50px; }
        .road-progress { position: absolute; height: 16px; background: linear-gradient(90deg, #fcd34d, #f59e0b); border-radius: 20px; width: 0%; left: 50px; z-index: 2; transition: width 0.6s cubic-bezier(0.25, 1, 0.5, 1); }

        /* å·´å£«æ ·å¼ */
        #bus {
            position: absolute; width: 110px; height: 75px; z-index: 50; top: 50%;
            transform: translate(-50%, -90%); filter: drop-shadow(0 6px 12px rgba(0,0,0,0.2));
            cursor: grab;
            touch-action: none;
            user-select: none;
            /* é»˜è®¤å¸¦æœ‰è¿‡æ¸¡æ•ˆæœï¼Œæ‹–æ‹½æ—¶é€šè¿‡JSç§»é™¤ */
            transition: left 0.6s cubic-bezier(0.25, 1, 0.5, 1);
        }
        #bus:active { cursor: grabbing; }

        .signboard {
            position: absolute; background: #22c55e; color: white; padding: 4px 12px;
            border-radius: 12px; font-size: 13px; bottom: 120%; left: 50%;
            transform: translateX(-50%); white-space: nowrap; box-shadow: 0 4px 0 #16a34a;
            pointer-events: none;
        }

        /* åŸå¸‚èŠ‚ç‚¹ */
        .city-node { position: absolute; z-index: 20; display: flex; flex-direction: column; align-items: center; transform: translateX(-50%); pointer-events: none;}
        .city-pin { width: 12px; height: 12px; background: white; border: 3px solid #3b82f6; border-radius: 50%; }
        .city-name { margin-top: 8px; font-size: 12px; font-weight: 900; color: #1e3a8a; background: rgba(255,255,255,0.9); padding: 1px 6px; border-radius: 8px; }

        /* --- ä»»åŠ¡å¡ç‰‡ --- */
        .task-card {
            background: white; border-radius: 25px; padding: 20px;
            box-shadow: 0 15px 30px rgba(0,0,0,0.1); display: none;
            width: 90%; max-width: 380px; margin-top: 10px; z-index: 50;
        }
        .task-card.active { display: block; animation: pop-in 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes pop-in { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        .btn-submit { background: #f97316; color: white; padding: 10px 20px; border-radius: 12px; font-weight: bold; box-shadow: 0 4px 0 #c2410c; }
        .btn-submit:active { transform: translateY(2px); box-shadow: 0 2px 0 #c2410c; }

        /* --- åé¦ˆå¼¹çª—ä¸ç‰¹æ•ˆ --- */
        .success-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.7);
            display: none; flex-direction: column; align-items: center; justify-content: center;
            z-index: 1000; backdrop-filter: blur(4px);
        }
        .success-overlay.show { display: flex; }

        #confetti-canvas { position: fixed; inset: 0; pointer-events: none; z-index: 1100; }

        .step-dot { width: 12px; height: 12px; border-radius: 50%; background: #e2e8f0; transition: all 0.3s; }
        .step-dot.active { background: #3b82f6; transform: scale(1.4); }
        .step-dot.done { background: #22c55e; }

        #music-toggle {
            position: fixed; bottom: 30px; right: 30px; z-index: 2000;
            background: white; width: 50px; height: 50px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 6px 15px rgba(0,0,0,0.2); cursor: pointer;
            font-size: 24px; border: 3px solid #3b82f6;
            transition: transform 0.2s;
        }
        #music-toggle:active { transform: scale(0.9); }
    </style>
</head>
<!-- ç‚¹å‡»é¡µé¢ä»»æ„ä½ç½®å°è¯•å”¤é†’éŸ³é¢‘ä¸Šä¸‹æ–‡ -->
<body onclick="forceStartAudio()">

    <!-- ç²’å­ç”»å¸ƒ -->
    <canvas id="confetti-canvas"></canvas>

    <!-- éŸ³ä¹å¼€å…³ -->
    <div id="music-toggle" onclick="toggleMusic(event)">
        <span id="music-icon">ğŸ”‡</span>
    </div>

    <!-- äº‘æœµèƒŒæ™¯åŠ¨ç”» -->
    <div class="cloud" style="top: 10%; width: 150px; height: 45px; animation-duration: 45s; left: -10%;"></div>
    <div class="cloud" style="top: 25%; width: 180px; height: 60px; animation-duration: 65s; animation-delay: -15s; left: 20%;"></div>

    <!-- é¡¶éƒ¨æ ‡é¢˜ä¸è¿›åº¦ -->
    <div class="header-bg text-center">
        <h1 class="text-xl font-black text-blue-600 tracking-wide">ğŸšŒ å°å°é‡Œç¨‹å¸ˆï¼šäº‘å—è·¯çº¿å¤§æŒ‘æˆ˜</h1>
        <div class="flex justify-center gap-4 mt-2">
            <div class="step-dot active" id="dot-1"></div>
            <div class="step-dot" id="dot-2"></div>
        </div>
    </div>

    <!-- åœ°å›¾åŒºåŸŸ -->
    <div class="route-map" id="map-area">
        <div class="road-line"></div>
        <div class="road-progress" id="progress-bar"></div>

        <!-- åŸå¸‚åæ ‡ç‚¹ -->
        <div class="city-node" style="left: 50px;"><div class="city-pin"></div><div class="city-name">æ˜†æ˜(0)</div></div>
        <div class="city-node" style="left: 33.5%;"><div class="city-pin"></div><div class="city-name">æ¥šé›„(152)</div></div>
        <div class="city-node" style="left: 67%;"><div class="city-pin"></div><div class="city-name">å¤§ç†(328)</div></div>
        <div class="city-node" style="left: calc(100% - 50px);"><div class="city-pin"></div><div class="city-name">ä¸½æ±Ÿ(524)</div></div>

        <!-- å¯æ‹–æ‹½å·´å£« -->
        <div id="bus" style="left: 50px;">
            <div class="signboard" id="bus-sign">é‡Œç¨‹ï¼š0 km</div>
            <svg viewBox="0 0 110 70">
                <rect x="5" y="12" width="100" height="42" rx="10" fill="#3b82f6" stroke="#1e3a8a" stroke-width="2"/>
                <rect x="15" y="18" width="22" height="16" rx="4" fill="#e0f2fe" stroke="#1e3a8a" stroke-width="1"/>
                <rect x="42" y="18" width="22" height="16" rx="4" fill="#e0f2fe" stroke="#1e3a8a" stroke-width="1"/>
                <rect x="74" y="18" width="20" height="16" rx="4" fill="#e0f2fe" stroke="#1e3a8a" stroke-width="1"/>
                
                <!-- ä¹˜å®¢ä¸å¸æœºç»†èŠ‚ -->
                <g transform="translate(18, 20)">
                    <circle cx="8" cy="8" r="5" fill="#fca5a5"/>
                    <path d="M3 5 Q8 0 13 5" fill="#4ade80" />
                    <circle cx="6" cy="7" r="0.6" fill="#000"/>
                    <circle cx="10" cy="7" r="0.6" fill="#000"/>
                </g>
                <g transform="translate(46, 20)">
                    <circle cx="8" cy="8" r="5" fill="#fcd34d"/>
                    <path d="M3 8 Q8 2 13 8" fill="#ec4899" />
                    <circle cx="6" cy="8" r="0.6" fill="#000"/>
                    <circle cx="10" cy="8" r="0.6" fill="#000"/>
                </g>
                <g transform="translate(77, 19)">
                    <circle cx="7" cy="7" r="4.5" fill="#fdba74"/> 
                    <path d="M1 5 Q7 1 13 5" fill="#1e3a8a" />
                    <circle cx="9" cy="6.5" r="0.8" fill="#1e293b"/>
                    <path d="M6 9 Q7.5 10 9 9" fill="none" stroke="#be123c" stroke-width="0.8"/>
                </g>

                <circle cx="28" cy="54" r="9" fill="#1e293b" /><circle cx="28" cy="54" r="4" fill="#94a3b8" />
                <circle cx="82" cy="54" r="9" fill="#1e293b" /><circle cx="82" cy="54" r="4" fill="#94a3b8" />
            </svg>
        </div>
    </div>

    <!-- ä»»åŠ¡åŒºåŸŸ -->
    <main class="flex flex-col items-center">
        <!-- ä»»åŠ¡ 1 -->
        <div class="task-card active" id="card-1">
            <h2 class="font-black text-blue-600 mb-2 text-lg">ç¬¬ä¸€å…³ï¼šè·¯ç¨‹æŒ‘æˆ˜</h2>
            <p class="text-gray-600 mb-4">ä»ã€æ¥šé›„ã€‘åˆ°ã€å¤§ç†ã€‘è¦å¼€å¤šå°‘å…¬é‡Œï¼Ÿ<br><span class="text-xs text-blue-400">æç¤ºï¼š328 - 152 = ?</span></p>
            <div class="flex gap-3">
                <input type="number" id="input-1" placeholder="???" autocomplete="off" class="flex-1 bg-blue-50 border-2 border-blue-100 rounded-xl px-4 py-2 text-xl font-bold text-center focus:outline-none focus:border-blue-400">
                <button onclick="checkAnswer(1, 176)" class="btn-submit">éªŒè¯</button>
            </div>
        </div>

        <!-- ä»»åŠ¡ 2 -->
        <div class="task-card" id="card-2">
            <h2 class="font-black text-blue-600 mb-2 text-lg">ç¬¬äºŒå…³ï¼šç»ˆç‚¹æŒ‘æˆ˜</h2>
            <p class="text-gray-600 mb-4">ä»ã€å¤§ç†ã€‘åˆ°ã€ä¸½æ±Ÿã€‘è¦å¼€å¤šå°‘å…¬é‡Œï¼Ÿ<br><span class="text-xs text-blue-400">æç¤ºï¼š524 - 328 = ?</span></p>
            <div class="flex gap-3">
                <input type="number" id="input-2" placeholder="???" autocomplete="off" class="flex-1 bg-blue-50 border-2 border-blue-100 rounded-xl px-4 py-2 text-xl font-bold text-center focus:outline-none focus:border-blue-400">
                <button onclick="checkAnswer(2, 196)" class="btn-submit">éªŒè¯</button>
            </div>
        </div>
    </main>

    <!-- æˆåŠŸå¼¹çª— -->
    <div id="success-overlay" class="success-overlay">
        <div class="bg-white p-8 rounded-3xl text-center shadow-2xl mx-4 max-w-sm relative">
            <div class="mb-4 inline-block transform scale-125">ğŸ†</div>
            <h1 class="text-blue-600 text-3xl font-black mb-2">å¤ªæ£’äº†ï¼</h1>
            <p id="reward-text" class="text-gray-600 mb-8 font-bold"></p>
            <button id="overlay-btn" class="bg-blue-600 text-white px-10 py-3 rounded-full font-black text-lg shadow-lg active:scale-95 w-full">
                ç»§ç»­å‰è¿› â”
            </button>
        </div>
    </div>

    <script>
        // --- æ¸¸æˆçŠ¶æ€ ---
        const state = {
            level: 1,
            totalKm: 524,
            audioInited: false,
            musicPlaying: true, // é»˜è®¤å¼€å¯
            isDraggingBus: false,
            bgmLoopId: null
        };

        // --- éŸ³é¢‘ç³»ç»Ÿ (8-bit é£æ ¼) ---
        let audioCtx, masterGain;
        const melody = [261, 329, 392, 523, 392, 329, 440, 392]; // C4-E4-G4-C5 å¾ªç¯

        function forceStartAudio() {
            if (!state.audioInited) {
                initAudio();
            } else if (audioCtx && audioCtx.state === 'suspended') {
                audioCtx.resume();
            }
        }

        function initAudio() {
            try {
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                if (!AudioContext) return;
                
                audioCtx = new AudioContext();
                masterGain = audioCtx.createGain();
                masterGain.connect(audioCtx.destination);
                masterGain.gain.value = 0.3; // é€‚å½“éŸ³é‡
                
                state.audioInited = true;
                if (state.musicPlaying) {
                    document.getElementById('music-icon').innerText = 'ğŸµ';
                    startBGM();
                }
            } catch (e) {
                console.error("Audio init failed", e);
            }
        }

        function playTone(freq, type, duration, volume = 0.2) {
            if (!audioCtx || audioCtx.state === 'suspended') return;
            const osc = audioCtx.createOscillator();
            const g = audioCtx.createGain();
            osc.type = type;
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            g.gain.setValueAtTime(volume, audioCtx.currentTime);
            g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + duration);
            osc.connect(g);
            g.connect(masterGain);
            osc.start();
            osc.stop(audioCtx.currentTime + duration);
        }

        function startBGM() {
            if (state.bgmLoopId) clearTimeout(state.bgmLoopId);
            let step = 0;
            const loop = () => {
                if (state.musicPlaying && audioCtx && audioCtx.state === 'running') {
                    playTone(melody[step % melody.length], 'sine', 0.5, 0.05); // æŸ”å’ŒèƒŒæ™¯éŸ³
                    step++;
                }
                state.bgmLoopId = setTimeout(loop, 450);
            };
            loop();
        }

        function toggleMusic(e) {
            e.stopPropagation();
            if (!state.audioInited) {
                initAudio();
                return;
            }
            state.musicPlaying = !state.musicPlaying;
            document.getElementById('music-icon').innerText = state.musicPlaying ? 'ğŸµ' : 'ğŸ”‡';
            
            if (state.musicPlaying) {
                if(audioCtx.state === 'suspended') audioCtx.resume();
                startBGM();
            }
        }

        // --- æ‹–æ‹½ä¸UIæ›´æ–°é€»è¾‘ ---
        const bus = document.getElementById('bus');
        const mapArea = document.getElementById('map-area');
        const progressBar = document.getElementById('progress-bar');
        const busSign = document.getElementById('bus-sign');

        function updateBusUI(leftPx, skipTransition = false) {
            const rect = mapArea.getBoundingClientRect();
            const padding = 50;
            const roadWidth = rect.width - (padding * 2);
            
            let x = Math.max(padding, Math.min(leftPx, rect.width - padding));
            
            // æ‹–åŠ¨æ—¶ç¦ç”¨è¿‡æ¸¡ï¼Œä¿è¯è·Ÿéšï¼›è‡ªåŠ¨ç§»åŠ¨æ—¶å¯ç”¨è¿‡æ¸¡
            if (skipTransition) {
                bus.style.transition = 'none';
                progressBar.style.transition = 'none';
            } else {
                bus.style.transition = 'left 0.6s cubic-bezier(0.25, 1, 0.5, 1)';
                progressBar.style.transition = 'width 0.6s cubic-bezier(0.25, 1, 0.5, 1)';
            }

            bus.style.left = x + 'px';
            let percent = ((x - padding) / roadWidth) * 100;
            progressBar.style.width = percent + '%';
            
            let km = Math.round(state.totalKm * (percent / 100));
            busSign.innerText = `é‡Œç¨‹ï¼š${km} km`;
        }

        // ç»‘å®šæ‹–æ‹½äº‹ä»¶
        bus.addEventListener('mousedown', startDrag);
        bus.addEventListener('touchstart', startDrag, {passive: false});

        function startDrag(e) {
            forceStartAudio(); // ç”¨æˆ·äº¤äº’æ—¶å°è¯•å”¤é†’éŸ³é¢‘
            state.isDraggingBus = true;
            e.stopPropagation();
        }

        window.addEventListener('mousemove', drag);
        window.addEventListener('touchmove', drag, {passive: false});

        function drag(e) {
            if (!state.isDraggingBus) return;
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const mapRect = mapArea.getBoundingClientRect();
            updateBusUI(clientX - mapRect.left, true);
            if(e.cancelable) e.preventDefault();
        }

        window.addEventListener('mouseup', stopDrag);
        window.addEventListener('touchend', stopDrag);

        function stopDrag() {
            if (!state.isDraggingBus) return;
            state.isDraggingBus = false;
        }

        // çª—å£å¤§å°æ”¹å˜æ—¶é‡ç½® Canvas
        window.addEventListener('resize', () => {
            const canvas = document.getElementById('confetti-canvas');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });

        // --- æ¸¸æˆä¸šåŠ¡æµç¨‹ ---
        function checkAnswer(lvl, correct) {
            forceStartAudio();
            const input = document.getElementById(`input-${lvl}`);
            const val = parseInt(input.value);
            
            if (val === correct) {
                // æ­£ç¡®éŸ³æ•ˆ
                playTone(880, 'square', 0.1, 0.1);
                setTimeout(() => playTone(1320, 'square', 0.3, 0.1), 80);
                
                if (lvl === 1) {
                    showOverlay("ç¬¬ä¸€é˜¶æ®µå®Œæˆï¼å·´å£«æ­£åœ¨å‰å¾€å¤§ç†ï¼");
                    moveToPercent(67); // ç§»åŠ¨åˆ°å¤§ç†
                } else {
                    showOverlay("ç»ˆç‚¹æŠµè¾¾ï¼ä½ å·²ç»æˆä¸ºä¸€åä¼˜ç§€çš„é‡Œç¨‹å¸ˆï¼");
                    moveToPercent(100); // ç§»åŠ¨åˆ°ä¸½æ±Ÿ
                    document.getElementById('overlay-btn').innerText = "é‡æ–°æŒ‘æˆ˜ â”";
                }
            } else {
                // é”™è¯¯éŸ³æ•ˆ
                playTone(150, 'sawtooth', 0.4, 0.15);
                const card = document.getElementById(`card-${lvl}`);
                card.style.animation = 'shake 0.4s';
                setTimeout(() => card.style.animation = '', 400);
            }
        }

        function moveToPercent(percent) {
            const rect = mapArea.getBoundingClientRect();
            const padding = 50;
            const roadWidth = rect.width - (padding * 2);
            const targetX = padding + (roadWidth * (percent / 100));
            updateBusUI(targetX);
        }

        function showOverlay(msg) {
            document.getElementById('reward-text').innerText = msg;
            document.getElementById('success-overlay').classList.add('show');
            createConfetti();
        }

        document.getElementById('overlay-btn').onclick = () => {
            forceStartAudio();
            document.getElementById('success-overlay').classList.remove('show');
            if (state.level === 2) {
                resetGame();
            } else {
                // å…³å¡åˆ‡æ¢åˆ° 2
                document.getElementById(`dot-${state.level}`).classList.add('done');
                document.getElementById(`card-${state.level}`).classList.remove('active');
                state.level++;
                document.getElementById(`dot-${state.level}`).classList.add('active');
                document.getElementById(`card-${state.level}`).classList.add('active');
            }
        };

        function resetGame() {
            // é‡ç½®çŠ¶æ€
            state.level = 1;
            document.getElementById('overlay-btn').innerText = "ç»§ç»­å‰è¿› â”";
            document.getElementById('input-1').value = "";
            document.getElementById('input-2').value = "";
            
            // é‡ç½®ç‚¹çŠ¶è¿›åº¦
            for(let i=1; i<=2; i++) {
                document.getElementById(`dot-${i}`).classList.remove('active', 'done');
                document.getElementById(`card-${i}`).classList.remove('active');
            }
            document.getElementById('dot-1').classList.add('active');
            document.getElementById('card-1').classList.add('active');
            
            // å·´å£«å½’ä½ (éœ€è¦ç­‰å¾…ä¸€å°æ®µæ—¶é—´è®© transition ç”Ÿæ•ˆæˆ–å¼ºåˆ¶é‡ç»˜ï¼Œè¿™é‡Œç›´æ¥åˆ©ç”¨ updateUI é€»è¾‘)
            moveToPercent(0); 
        }

        // --- æ’’èŠ±ç‰¹æ•ˆ ---
        const canvas = document.getElementById('confetti-canvas');
        const ctx = canvas.getContext('2d');
        let particles = [];
        
        function createConfetti() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            particles = [];
            for (let i = 0; i < 80; i++) {
                particles.push({
                    x: canvas.width / 2, y: canvas.height / 2,
                    vx: (Math.random() - 0.5) * 15, vy: (Math.random() - 0.5) * 15 - 5,
                    size: Math.random() * 8 + 4,
                    color: `hsl(${Math.random() * 360}, 80%, 60%)`,
                    gravity: 0.3, life: 1.0
                });
            }
            const anim = () => {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                particles.forEach((p, i) => {
                    p.vy += p.gravity; p.x += p.vx; p.y += p.vy; p.life -= 0.015;
                    ctx.globalAlpha = p.life; ctx.fillStyle = p.color;
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, p.size/2, 0, Math.PI*2);
                    ctx.fill();
                    if (p.life <= 0) particles.splice(i, 1);
                });
                if (particles.length > 0) requestAnimationFrame(anim);
            };
            anim();
        }

        // é”™è¯¯æŠ–åŠ¨åŠ¨ç”»æ ·å¼
        const s = document.createElement('style');
        s.innerHTML = `@keyframes shake { 0%,100%{transform:translateX(0)} 25%{transform:translateX(-10px)} 75%{transform:translateX(10px)} }`;
        document.head.appendChild(s);
    </script>
</body>
</html>